---
title: "Musical Sophistication and Valence Estimation"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: cosmo
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(Cairo)
library(DT)
library(reshape2)
library(data.table)
library(varhandle)
```


```{r survey data}
#data cleaning 

data_wide <-
  read_csv('survey upd1.csv', TRUE)

#deleting irrelevant columns
data_wide <- data_wide[, -c(1:8, 24, 28:29)]

#COLUMNS 1:18 ARE MSI RESULTS
#COLUMN 19 IS SONG ORDER

#deleting all instances of 'MSI' in front of a value
data_wide <- data.frame(lapply(data_wide, function(x){
  gsub("MSI", "", x)
}))

#renaming the MSI columns
names(data_wide)[1:18] = paste0("MSI", 1:18)

#renaming the valence columns
names(data_wide)[c(20:69)[seq(1, 50, 2)]] = paste0("song", 1:25, "_valence")

#renaming the familiarity columns
names(data_wide)[c(20:69)[seq(2, 50, 2)]] = paste0("song", 1:25, "_familiarity")

#splitting the columns from "songID_valenceEst" to column "songID" and column "valenceEst"
setDT(data_wide)
cols <- grep("song", names(data_wide), value = TRUE)
for (i in cols) {
  temp <- tstrsplit(data_wide[[i]], "_")
  set(data_wide, j = sprintf("%s_%d", i, seq_along(temp)), value = temp)
  set(data_wide, j = i, value = NULL)
}

#deleting duplicate-value columns (familiarity_1)
data_wide <- data_wide[, -c(20:119)[seq(3, 100, 4)]]

names(data_wide) <- gsub("valence_1", "ID", names(data_wide))
names(data_wide) <- gsub("valence_2", "estVal", names(data_wide))
names(data_wide) <- gsub("familiarity_2", "familiar", names(data_wide))

data_wide <- unfactor(data_wide)

part_data_wide <-
  read_csv2("participants_results.csv")

#deleting irrelevant columns
part_data_wide <- part_data_wide[, -1]

#renaming the deviation columns
names(part_data_wide)[c(4:6)] = paste0("dev", 1:3)
names(part_data_wide)[1] = "MSI_total"
names(part_data_wide)[2] = "ValOff_total"

data_wide$MSI1 <- part_data_wide$MSI_total
data_wide <- data_wide[, -c(2:18)]
names(data_wide)[1] = "MSI_TOTAL"

write.csv(data_wide, "data_wide_clean.csv")

```



```{r lengthening}
# 
# data_long <-
#   data_wide %>%
#   gather()
```

Sidebar {.sidebar}
===
**Study abstract**

The present study investigated the relationship between musical sophistication and musical valence estimation. This was done by having participants listen to a random selection of songs, representative of 12 genres, and collecting their valence estimations of each song via an R Shiny app. Musical sophistication was measured using the Gold-MSI questionnaire, and musical valence estimation was measured using a 7-point Likert scale. missing:RESULTS. missing:CONCLUSION

**Scatterplot interpretation**

Higher scores on the x-axis indicate higher musical sophistication.

Lower scores on the y-axis (Valence Estimation) indicate, on average, *higher* accuracy when estimating a musical fragment's valence.

**Explanation of terms**

**Valence** - the intrinsic positiveness that is associated, in this case, with a musical stimulus. High valences indicates positive emotional states such as happiness/cheerfulness, whereas low valence indicates negative emotional dimensions such as sadness/gloominess.

**Musical sophistication** - the musical attitudes, skills and expertise of an individual.


Results {data-orientation=rows}
===

Column {.tabset}
---

### Overall {data-height=800}

```{r}
# This window will contain a scatterplot showing the relationship between people's scores on the MSI (x-axis) and their scores on the valence estimation measure (y-axis). Readers will also be able to view the same relationship controled for each genre, e. g., what would the scatterplot look like if only electronic songs were used in the study?
# 
# OR
# 
# This window will contain boxplots, with the participants being split into quintiles based on their MSI scores. These quintiles will be placed on the x-axis, whereas the y-axis will contain a quintile's valence estimation accuracy.

options(repr.plot.width=800, repr.plot.height=500)
part_data_wide %>%
  ggplot(aes(x = MSI_total, y = ValOff_total)) +
  geom_point() +
  geom_smooth(method = "lm") +
  annotate(x = 100, y = 37, 
         label=paste("r = ", round(cor(part_data_wide$MSI_total, part_data_wide$ValOff_total),2)), 
         geom="text", size=5) +
  scale_x_continuous(name = 'Gold-MSI Score') +
  scale_y_continuous(name = 'Valence Estimation Accuracy') +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "gray")
        )
```

### Pop

These tabs will contain violin plots, with signed valence accuracy on the y-axis and the actual mean genre valence as a line in the violin. In other words, this will allow to visually understand whether some genres were consistently over- or under-valued. 
```{r pop specific}



```


### Rock


### Dance


### Electronic


### House


### Soundtracks


### Hip-Hop


### Singer/Songwriter


### Classical


### R&B


### Soul/Blues


### Metal


Column {data-width=1}
---

### Experiment: Demo {data-height=200}

This window will contain a demonstration of the survey we used to collect the data. The demonstration will comprise a small number of MSI items, a trial round (1 fragment), and then X number of song fragments.
This will help the reader to quickly and intuitively get a sense of the survey, and what it was like to complete it.


Introduction & Methods
===

Column {data-width=860}
---

### Introduction {data-height=810}

Nowadays, music is more present in our lives than ever before. According to the latest reports, an average person spends around 18 hours a week listening to music (IFPI 2018). The majority of this time is spent on streaming platforms like Spotify, which have displayed a consistent growth in revenue over the past decade. The fact that music has become omnipresent in our lives raises the question whether this makes people better at identifying and assessing certain musical features. In other words, is there a difference between how normal and musically sophisticated individuals perceive features of music? If this would turn out to be true, this would indicate that the way we think about music, in fact, depends on our exposure to them.

Although this question has not been addressed directly in the academic literature, researchers have investigated how differences in musical engagement between people lead to differences in the perception of musical valence and arousal, with valence being defined as the positiveness of a track (REFERENCE), and arousal as the state of being alert or awake (REFERENCE). In their research, Olsen and colleagues (2014) conclude that such a difference exists: the variable musical engagement is a significant predictor of perceived musical arousal and valence. However, the relationship between musical sophistication and perceived musical features has not been investigated by academics as of the time of writing.

To fill this gap in the literature, we decided to investigate the following research question in our study – are musically sophisticated people better at estimating a musical piece’s valence? We specifically chose to scrutinize the relationship between musical sophistication and valence, as valence is a clearly defined, well studied emotional dimension in psychology (REFERENCE). To answer our question, we make use of surveys in which we ask our participants to estimate the valence of 25 randomly selected songs. We subsequently compare their outcomes not only between each other, but also to Spotify’s valence rating of the song: our point of reference used by the world’s biggest streaming platform (REFERENCE). 



### Raw data 

```{r raw data}

DT::datatable(data_wide, options = list(
  bPaginate = FALSE
))

```

Column {.tabset}
---

### Materials

**Song pool**: the song pool contains 240 songs, with 20 songs per genre. The genres include: pop, rock, metal, electronic, dance, house, hip-hop, singer/songwriter, soundtrack, R&B, soul/blues and classical music. 

**Randomized playlist**: from the song pool, 25 songs are randomly selected for each participant to listen to and rate.

**Gold-MSI**: a questionnaire used to measure musical sophistication. Calculated as total number of points on the measure. Only the short version of the questionaire is used, i. e., only the items that map onto the general musical sophistication factor.

**Trial round**: prior to the main valence estimation task, participants are presented with two songs which they rate the valence of, and are then provided with the true valence of said songs. This is used to help the participants better conceptualize what valence is, and what the main task will look like.

**Valence rating**: a 7-point Likert scale, ranging from "Extremely low" (1) to "Extremely high" (7), used to estimate a song's valence.

**Familiarity measure**: a measured used to indicate whether the participant is familiar with the song that they are rating. This is used in later analysis to see if familiarity affects participant’s judgements of a song’s valence. Measured as 1 (familiar) or 0 (unfamiliar).

**R Shiny web app**: the web app is used to construct a randomized playlist from the song pool, administer the Gold-MSI, and collect valence and familiarity data.
         

### Song selection

In total, 242 songs were used in this experiment.

Two songs were the same for each participant, namely the trial round songs. These were selected to help participants better conceptualize musical valence. The first song had an extremely high valence value (7), whereas the second song was closer to the middle of the scale and had a slightly low value (3).

The selection process for the other 240 songs began with a breakdown of musical genres - we chose 12 genres based on a survey that was conducted using a sample of 19000 people between the age of 16-64, measuring the 12 most consumed genres of music in the U.S. (REFERENCE). For each genre 20 songs were selected making use of the website ‘rateyourmusic.com’, where albums can be sorted by their average user-submitted rating, by genre. We sampled songs from these highly-rated albums, working under the assumption that well-regarded albums in a given genre are the most representative of said genre. Each sample of songs contained  only one song per artist, in a given genre.

During the selection process, we also took note of the valence of the sampled songs. We made sure that - per genre - no valence value was overrepresented or underrepresented, given what is usual for a specific genre; e. g., if a genre is generally characterized as having songs with higher valence, the song pool for said genre would be skewed towards, on average, higher values as well (compared to a song pool of a genre that is characterized as having lower valence songs).

Once the songs were selected, we trimmed each musical item's length. As a rule of thumb, we chose the 15 seconds from one minute of playback into the song. Some of the selected songs started with an intro, however, this did not count towards the minute.

### Procedure

Participants begin the experiment by completing the Gold-MSI to collect measures for musical sophistication. Participants are then  directed to the main experiment, where they are first  presented with a practice round. In the practice round, participants listen to two songs, and are then asked to rate each song’s valence. After each rating in the practice round, participants are presented with the song’s true valence as determined by Spotify. After this, participants proceed to the main task, which contains the randomized playlist. After listening to a song from the playlist, participants rate the valence using a 7-point Likert scale, and indicate whether they are familiar with the song.



Discussion
===

Column
---

### General conclusion 

The present study sought to investigate the relationship between musical sophistication and valence estimation by comparing people's valence estimates against values provided by Spotify. Counter to the main hypohtesis, the results showed a weak positive relationship between musical sophistication and valence estimation inaccuracy. This indicates that musical sophistication is not a predictor of accurate perception of musical valence, and that musical sophistication might even interfere with valence perception, though this should be taken with a grain (or nugget) of salt. MISSING INFO: GENRE BREAKDOWN. MISSING INFO: CORRELATION WITH SPOTIFY'S VALUES AND DISCUSSION OF THESE RESULTS.

### Correlation: Estimated Valence and True Valence

This window will contain a scatterplot visualizing the correlation between each song's (average) estimated valence, and Spotify's 'true' valence values


Column
---

### Genre & Valence Estimate Deviation

```{r genres data}

genres_data <- read_csv2("genres_results.csv")

genres_data %>%
  ggplot(aes(x = genre, y = valence_total_dev)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +
  scale_x_discrete(name = element_blank()) +
  scale_y_continuous(name = 'Total Valence Deviation') +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.line = element_line(colour = "gray35")
        )

```

### Future research

This window will contain advice for future research into the area of musical valence. Contents will depend on correlation with Spotify's values and (less so) on insights gained from genre breakdown.

Appendix
===

Column
---

### References

This window will contain references to the material that we use throught the report.

Column
---

### Downloadables

Links to our GitHub repositories, and to downloadables of the data we used

